WPA:
Intermediate solution by wifi alliance
Uses TKIP
	Based on WEP
Hardware changes not required
Firmware update is required.

WPA 2:
Long term solution 802.11i
Uses CCMP
	Based on AES
Hardware changes required.

Both WPA and WPA2 have personal and enterprise edition

Personal is PSK
Enterprise is 802.1x + Radius

How does the client know ?
Beacon frames
Probe response packets from the AP
Can be used to create a WPA/WPA2 honeypot as well.

Checking for WPA :
airodump-ng wlan0mon --channel 1

We have to analyze if the probe request has anything related to security encryptions.

Checking for WPA 2 :
Do the same above procedure.

But look for EAPOL (Key message 1,2,3,4)


Extended WPA handshake architecture :

Static key is used to transmit data.

So dynamic key is used to prevent WEP attacks.

PBKDF2
Password Based Key Derivation Function
RFC 2898
PBKDF2(Passphrase,SSID,ssidLen,4096,256)
4096 - Number of times the passphrase is hashed
256 - Intended Key Length of PSK.

Both the supplicant(client)and authenticator(router) has a preshared key 256 bit

The authenticator sends a ANounce(Authenticator Nounce) to supplicant

Snounce(Supplicant Nounce) (PTK) Shared

airodump-ng --channel 1 wlan0mon --write wpa-psk-demo

Sniff in wireshark with bssid and remove beacon frames.

wireshark wpa-psk-demo-01.cap &

Search for 'eapol' packet.
(Need to capture all the 4 eapol packets)

Pairwise Transient Key:
PTK = Function(PMP, ANounce,SNounce,Authenticator MAC,Supplicant MAC)

-PMK = Pre-Shared Key(Pairwise Master Key)
-ANounce = Random by AP
-SNounce = Random by Client
-Authentication MAC = AP MAC
-Supplicant MAC = Client MAC

Now the client sends the message with SNounce + MIC.

In wireshark we can see the WPA Key MIC, Snonce key in Security 802.11x tab.

Then from the authenticatior side PTK, Message 3 which is a key installation is sent to client.

Message 4 is sent from supplicant to Authenticator as key acknowledgement.

